{% extends "base.html" %}

{% block content %}

<div class="container my-2">
    <div class="accordion" id="helpPageAccordion">
        <div class="accordion-item">
            <h2 class="accordion-header" id="actionsHeading">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#actionsCollapse" aria-expanded="false" aria-controls="actionsCollapse">
                    Права на выполнение действий
                </button>
            </h2>
            <div id="actionsCollapse" class="accordion-collapse collapse" aria-labelledby="actionsHeading"
                data-bs-parent="#helpPageAccordion">
                <div class="accordion-body table-responsive-lg">
                    <table class="table table-striped">
                        <caption>*Все означает "все зарегистрированные заявки", *Только свои означает "только заявки,
                            для которых
                            пользователь является инициатором"</caption>
                        <thead>
                            <tr>
                                <th scope="col">Действия/Права</th>
                                <th scope="col">Администратор</th>
                                <th scope="col">Инициатор</th>
                                <th scope="col">Валидатор</th>
                                <th scope="col">Закупщик</th>
                                <th scope="col">Наблюдатель</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">Просмотр заявок</th>
                                <td class="text-success">Все</td>
                                <td class="text-warning">Только свои</td>
                                <td class="text-success">Все</td>
                                <td class="text-success">Все</td>
                                <td class="text-success">Все</td>
                            </tr>
                            <tr>
                                <th scope="row">Объединение/Разделение заявок</th>
                                <td class="text-success">Все</td>
                                <td class="text-warning">Только свои</td>
                                <td class="text-danger">Нет</td>
                                <td class="text-success">Все</td>
                                <td class="text-danger">Нет</td>
                            </tr>
                            <tr>
                                <th scope="row">Указать проект, объект и категории</th>
                                <td class="text-success">Все</td>
                                <td class="text-warning">Только свои</td>
                                <td class="text-success">Все</td>
                                <td class="text-success">Все</td>
                                <td class="text-danger">Нет</td>
                            </tr>
                            <tr>
                                <th scope="row">Указать статьи БДР и БДДС</th>
                                <td class="text-success">Все</td>
                                <td class="text-warning">Только свои</td>
                                <td class="text-success">Все</td>
                                <td class="text-success">Все</td>
                                <td class="text-danger">Нет</td>
                            </tr>
                            <tr>
                                <th scope="row">Оставить комментарий</th>
                                <td class="text-success">Все</td>
                                <td class="text-warning">Только свои</td>
                                <td class="text-success">Все</td>
                                <td class="text-success">Все</td>
                                <td class="text-danger">Нет</td>
                            </tr>
                            <tr>
                                <th scope="row">Клонировать заявку</th>
                                <td class="text-success">Все</td>
                                <td class="text-warning">Только свои</td>
                                <td class="text-danger">Нет</td>
                                <td class="text-success">Все</td>
                                <td class="text-danger">Нет</td>
                            </tr>
                            <tr>
                                <th scope="row">Уведомить согласующих</th>
                                <td class="text-success">Все</td>
                                <td class="text-warning">Только свои</td>
                                <td class="text-danger">Нет</td>
                                <td class="text-success">Все</td>
                                <td class="text-danger">Нет</td>
                            </tr>
                            <tr>
                                <th scope="row">Отправить заявку поставщику</th>
                                <td class="text-success">Все</td>
                                <td class="text-danger">Нет</td>
                                <td class="text-danger">Нет</td>
                                <td class="text-success">Все</td>
                                <td class="text-danger">Нет</td>
                            </tr>
                            <tr>
                                <th scope="row">Выгрузить заявку в Excel</th>
                                <td class="text-success">Все</td>
                                <td class="text-warning">Только свои</td>
                                <td class="text-success">Все</td>
                                <td class="text-success">Все</td>
                                <td class="text-success">Все</td>
                            </tr>
                            <tr>
                                <th scope="row">Выгрузить заявку для 1С</th>
                                <td class="text-success">Все</td>
                                <td class="text-danger">Нет</td>
                                <td class="text-success">Все</td>
                                <td class="text-success">Все</td>
                                <td class="text-danger">Нет</td>
                            </tr>
                            <tr>
                                <th scope="row">Согласование заявки</th>
                                <td class="text-danger">Нет</td>
                                <td class="text-danger">Нет</td>
                                <td class="text-success">Все</td>
                                <td class="text-danger">Нет</td>
                                <td class="text-danger">Нет</td>
                            </tr>
                            <tr>
                                <th scope="row">Создать новую заявку</th>
                                <td class="text-success">Разрешено</td>
                                <td class="text-success">Разрешено</td>
                                <td class="text-danger">Нет</td>
                                <td class="text-success">Разрешено</td>
                                <td class="text-danger">Нет</td>
                            </tr>
                            <tr>
                                <th scope="row">Законтрактовать</th>
                                <td class="text-danger">Нет</td>
                                <td class="text-danger">Нет</td>
                                <td class="text-danger">Нет</td>
                                <td class="text-success">Все</td>
                                <td class="text-danger">Нет</td>
                            </tr>
                            <tr>
                                <th scope="row">Управление лимитами</th>
                                <td class="text-success">Разрешено</td>
                                <td class="text-danger">Нет</td>
                                <td class="text-danger">Нет</td>
                                <td class="text-success">Разрешено</td>
                                <td class="text-danger">Нет</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header" id="projectsHeading">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#projectsCollapse" aria-expanded="false" aria-controls="projectsCollapse">
                    Подписки на проекты
                </button>
            </h2>
            <div id="projectsCollapse" class="accordion-collapse collapse" aria-labelledby="projectsHeading"
                data-bs-parent="#helpPageAccordion">
                <div class="accordion-body">
                    <div class="row">
                        <div class="col">
                            <input class="form-control" id="projectFilter" type="text" placeholder="Фильтр...">
                        </div>
                    </div>
                    <div class="table-responsive-md">
                        <table class="table table-striped table-responsive">
                            <thead>
                                <tr>
                                    <th scope="col">Проект</th>
                                    <th scope="col" style="width: 20%">Роли</th>
                                    <th scope="col" style="width: 20%">Пользователи</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for project in projects %}
                                {% for position in projects[project] %}
                                <tr class="project">
                                    {% if loop.first %}
                                    <th scope="row" rowspan="{{loop.length}}">{{ project }}</th>
                                    {% endif %}
                                    <td style="width: 20%">
                                        {{ position }}<br>
                                    </td>
                                    <td style="width: 20%">
                                        {% for user in projects[project][position] %}
                                        {% include '_user.popover.html' %}{{user.name}}<br>
                                        {% endfor %}
                                    </td>
                                </tr>
                                {% endfor %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <h2 class="accordion-header" id="categoriesHeading">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#categoriesCollapse" aria-expanded="false" aria-controls="categoriesCollapse">
                    Подписки на категории
                </button>
            </h2>
            <div id="categoriesCollapse" class="accordion-collapse collapse" aria-labelledby="categoriesHeading"
                data-bs-parent="#helpPageAccordion">
                <div class="accordion-body">
                    <div class="row">
                        <div class="col">
                            <input class="form-control" id="categoryFilter" type="text" placeholder="Фильтр...">
                        </div>
                    </div>
                    <div class="table-responsive-md">
                        <table class="table table-striped table-responsive">
                            <thead>
                                <tr>
                                    <th scope="col">Категория</th>
                                    <th scope="col" style="width: 20%">Роли</th>
                                    <th scope="col" style="width: 20%">Пользователи</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for category in categories %}
                                {% for position in categories[category] %}
                                <tr class="category">
                                    {% if loop.first %}
                                    <th scope="row" rowspan="{{loop.length}}">{{ category }}</th>
                                    {% endif %}
                                    <td style="width: 20%">
                                        {{ position }}<br>
                                    </td>
                                    <td style="width: 20%">
                                        {% for user in categories[category][position] %}
                                        {% include '_user.popover.html' %}{{user.name}}<br>
                                        {% endfor %}
                                    </td>
                                </tr>
                                {% endfor %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}

<script>
    document.addEventListener("DOMContentLoaded", () => {

        // Project Filter
        const projectFilter = document.querySelector('#projectFilter');
        if (projectFilter) {
            projectFilter.addEventListener('keyup', () => {
                const value = projectFilter.value.toLowerCase();
                const projectRows = document.querySelectorAll('.project');
                projectRows.forEach((projectRow) => {
                    const text = projectRow.textContent.toLowerCase();
                    const show = text.indexOf(value);
                    if (show > -1)
                        projectRow.classList.remove("d-none")
                    else
                        projectRow.classList.add("d-none");
                });
            });
        }

        // Category Filter
        const categoryFilter = document.querySelector('#categoryFilter');
        if (categoryFilter) {
            categoryFilter.addEventListener('keyup', () => {
                const value = categoryFilter.value.toLowerCase();
                const categoryRows = document.querySelectorAll('.category');
                categoryRows.forEach((categoryRow) => {
                    const text = categoryRow.textContent.toLowerCase();
                    const show = text.indexOf(value);
                    if (show > -1)
                        categoryRow.classList.remove("d-none")
                    else
                        categoryRow.classList.add("d-none");
                });
            });
        }
    });
</script>
{% endblock %}